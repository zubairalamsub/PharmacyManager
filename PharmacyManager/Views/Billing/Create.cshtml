@model PharmacyManager.Models.BillingViewModel
@{
    ViewData["Title"] = "New Invoice";
}

<div class="page-header">
    <h2>Create New Invoice</h2>
</div>

<div class="form-container">

    <div class="section-box">
        <h3>Invoice Information</h3>
        <div class="form-row">
            <div class="form-group">
                <label for="invoiceNumber">Invoice Number</label>
                <input type="text" id="invoiceNumber" value="@Model.InvoiceNumber" readonly />
            </div>
            <div class="form-group">
                <label for="invoiceDate">Date</label>
                <input type="date" id="invoiceDate" value="@Model.InvoiceDate.ToString("yyyy-MM-dd")" />
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="customerName">Customer Name</label>
                <input type="text" id="customerName" required placeholder="Enter customer name" />
            </div>
            <div class="form-group">
                <label for="contactNumber">Contact Number</label>
                <input type="text" id="contactNumber" placeholder="Enter contact number" />
            </div>
        </div>
    </div>


    <div class="section-box">
        <div class="section-header">
            <h3>Invoice Items</h3>
            <button type="button" id="btnAddRow" class="btn btn-primary">+ Add Item</button>
        </div>

        <table class="data-table" id="itemsTable">
            <thead>
                <tr>
                    <th>Medicine</th>
                    <th>Batch No</th>
                    <th>Expiry</th>
                    <th>Qty</th>
                    <th>Unit Price</th>
                    <th>Line Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="itemsBody">
            </tbody>
        </table>

        <div class="stock-message" id="stockMessage"></div>
    </div>

    <div class="section-box totals-section">
        <div class="totals-grid">
            <div class="total-row">
                <span class="total-label">Sub Total:</span>
                <span class="total-value" id="subTotal">0.00</span>
            </div>
            <div class="total-row">
                <span class="total-label">Discount:</span>
                <input type="number" id="discountInput" value="0" min="0" step="0.01" />
            </div>
            <div class="total-row total-row-grand">
                <span class="total-label">Grand Total:</span>
                <span class="total-value" id="grandTotal">0.00</span>
            </div>
        </div>
    </div>

    <div class="form-actions">
        <button type="button" id="btnSaveInvoice" class="btn btn-primary">Save Invoice</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Cancel</a>
    </div>
</div>

<script>
    var medicinesData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Medicines.Select(m => new {
        id = m.MedicineId,
        name = m.Name,
        batch = m.BatchNumber,
        expiry = m.ExpiryDate.ToString("yyyy-MM-dd"),
        price = m.UnitPrice,
        stock = m.StockQuantity
    })));
</script>

@section Scripts {
    <script src="~/js/site.js" asp-append-version="true"></script>
}
